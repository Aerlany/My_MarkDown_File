## 工程教育认证技术开发文档

### 一、项目构成

项目采用前后端分离架构:

- 前端项目代码地址：https://github.com/aerlany/manage_system
- 后端项目代码地址：https://github.com/aerlany/manage_system_bg

该项目主要用于：学院的课程统计和评价、统计学生成绩、课程目标和指标点达成度的计算

### 二、前端构成

前端使用Vue2框架开发，使用到相关技术栈：

- axios（用于进行异步请求）
- echarts、vue-echarts（图表分析及数据可视化工具）
- element-ui （前端图形库）
- mavon-editor（富文本编辑框 https://github.com/hinesboy/mavonEditor）
- vue-cookies（用于处理后端Token）
- vue-router（vue路由管理）
- vuex（vue数据存储）

值得注意的是：

1. 在我们需要添加一个组件（界面）时，我们应该在`@/components/`目录下按需求分包创建`templelate.vue`文件。然后在`@/router/`目录下先引入，再在合适的路径下注册

   ```js
   import templelate from'@/components/templelate'
   ```

   ```js
   const router = new VueRouter({
       routes: [
           {
               path: "/templelate",
               component: templelate
           },
       ]
   ```

2. Vuex  是一个专为 Vue.js 应用程序开发的**状态管理模式 + 库**。它采用集中式存储管理应用的所有组件的状态，并以相应的规则保证状态以一种可预测的方式发生变化。`@/store/`用于存储一些与用户相关的数据，采用模块化分包进行管理。
   Vuex详情文档 https://vuex.vuejs.org/zh/
   **读取数据**

   ```vue
   <script>
   import { mapGetters } from 'vuex'
   
   export default {
     computed: {
     // 使用对象展开运算符将 getter 混入 computed 对象中
       ...mapGetters([
         'doneTodosCount',
         'anotherGetter',
       ])
     }
   }
   </script>
   ```

3. 本项目的入口文件为 `LoginPage2.vue` 但是该文件中有一个方法在改组件挂载时调用

   ```js
   //该方法用于检查本地localstorage中是否存在的用户，并检查该登录Token是否过期 
   checkSubmit() {
   	api.post("/courseInfo/checkSubmit", "", (resp) => {
   		if (resp.data.flag && localStorage.getItem("name")) {					this.$router.push({ path: '/MainPage' });
            }
       })
   }
   ```

   所以`MainPage.vue`是该项目的主界面，在该处可以更改项目导航栏、控制每一个按钮跳转的路由。

4. 项目展示PDF文件。采用后端处理后将目标PDF文件读取为`Byte[]`传给前端，前端通过异步请求后将文档转为`BLOB`格式进行展示。

   ```js
   text(){
       axios.get(url, { responseType: "blob" }).then((response) => {         
          if (!response.headers['content-type'].includes("application/pdf")) {
             return;
          }
           // 将响应数据转换为Blob对象
          const blob = new Blob([response.data], { type: "application/pdf" });
   
          // 生成URL，将其分配给嵌入元素的src属性
          this.pdfUrl = URL.createObjectURL(blob);
        });
   }
   ```

   ```html
   <div style="height: 100vh;">
       <embed :src="pdfUrl" type="application/pdf"width="100%" height="100%" />
   </div>
   ```

### 三、后端构成

后端使用SpringBoot框架开发，使用到相关技术栈：

- mybatis 或 mybatis-plus （https://baomidou.com/pages/24112f/）
- druid 数据库链接池
  （https://github.com/alibaba/druid/wiki/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98）
-  Apache POI 文本处理工具 （http://www.javashuo.com/article/p-rkvtcese-bh.html）
- Spire.office.free 文本处理工具 （https://www.e-iceblue.cn/tutorials.html）
- JFreeChart 图像绘制工具 （https://iowiki.com/jfreechart/jfreechart_index.html）
- Swagger 在线生成接口文档工具 （https://javabetter.cn/springboot/swagger.html）
- fastJson 用于JSON字符串和字符数组之间的转换
- Sa-Token 权限认证 （https://sa-token.cc/）
- lombok 简化开发

值得注意的是：

1. 本项目采用标准的MVC架构

   > MVC英文是Model View Controller，是模型(model)－视图(view)－控制器(controller)的缩写，一种软件设计规范。本质上也是一种解耦。

   用一种业务逻辑、数据、界面显示分离的方法，将业务逻辑聚集到一个部件里面，在改进和个性化定制界面及用户交互的同时，不需要重新编写业务逻辑。

   - **Model**（模型）是应用程序中用于处理应用程序数据逻辑的部分。通常模型对象负责在数据库中存取数据。对应程序中的`mapper/`
   - **View**（视图）是应用程序中处理数据显示的部分。通常视图是依据模型数据创建的。对应程序中的`service/`
   - **Controller**（控制器）是应用程序中处理用户交互的部分。通常控制器负责从视图读取数据，控制用户输入，并向模型发送数据。对应程序中的`controller/`

   一般来说：
   `mapper`文件负责对数据库进行操作（SQL语句相关）。

   `service`文件负责对mapper层获得的数据进行处理封装，以及处理比较复杂的业务逻辑。

   `controller`文件负责书写与前端交互的接口。

2. SaToken的相关配置

   在`config/SaTokenConfigure`文件中包含Token的生成规则和接口访问的权限拦截。

   如果又遇到Token相关的报错，请先却保该接口没有被拦截。

### 四、服务器相关配置与项目运维

1. **连接远程服务器（当接入到学校校园网时才可以）**

   ```sh
   ssh root@218.194.100.49
   ```

   第一次链接时需要手动输入密码（`密码去问徐老师，他改了我也不知道`）

   登录后我们`cd .ssh`可以看到`id_rsa`文件，这是远程连接服务器的私钥。

   ```sh
   [root@localhost ~]# ll
   总用量 2464
   -rw-r--r--  1 root root 2521325 9月  16 16:53 Manage_system.sql
   drwxr-xr-x. 5 root root     212 11月  1 14:25 Project
   [root@localhost ~]# cd .ssh
   [root@localhost .ssh]# ll
   总用量 12
   -rw-------  1 root root  581 10月 28 16:17 authorized_keys
   -rw-------  1 root root 2610 10月 28 16:29 id_rsa
   -rw-r--r--. 1 root root  175 5月  16 13:20 known_hosts
   ```

   将`id_rsa`复制到我们自己的机器上，在本机的终端中输入：

   ```sh
    cd .ssh && scp root@218.194.100.49:.ssh/id_rsa ./
   ```

   就可以实现免密码登录。

2. **前端项目重启**

   查看当前本机端口运行情况：

   ```sh
   [root@localhost ~]# netstat -ntlp
   Active Internet connections (only servers)
   Proto Local Address  Foreign Address  State    PID/Program name    
   tcp   0.0.0.0:22     0.0.0.0:*        LISTEN   1132/sshd           
   tcp   0.0.0.0:888    0.0.0.0:*        LISTEN   1968/nginx: master  #nginx前端服务
   tcp   127.0.0.1:25   0.0.0.0:*        LISTEN   1489/master         
   tcp6  :::3306        :::*             LISTEN   1585/mysqld         #mysql服务
   tcp6  :::8080        :::*             LISTEN   6449/java           #后端服务
   tcp6  :::22          :::*             LISTEN   1132/sshd           
   tcp6  :::888         :::*             LISTEN   1968/nginx: master  
   tcp6  ::1:25         :::*             LISTEN   1489/master         
   ```

   当该命令展示出来的数据中没有`nginx`相关进程，则`nginx`服务未启动。

   `nginx`相关命令

   ```sh
   systemctl start nginx     #启动nginx
   systemctl status nginx    #查看nginx运行状态
   systemctl restart nginx   #重启nginx
   systemctl stop nginx      #停止nginx
   ```

   确保`nginx`正确启动，开始部署前端项目。

   打包项目。在本地的前端项目路径的终端下运行：

   ```sh
   npm run build
   ```

   打包项目。它会在项目路径下生成`dist/`文件夹。将其传输到服务器`/usr/share/nginx`路径下。

   ```sh
   scp -r dist/ root@218.194.100.49:/usr/share/nginx/
   ```

   查看服务器文件，刚刚上传的`dist/`文件夹就在这：

   ```sh
    cd /usr/share/nginx/ && ll
   ```

   删除路径中原有的`html`文件夹，将`dist`文件夹改名为`html`：

   ```sh
   rm -rf html && mv dist html
   ```

   刷新`nginx`，前端项目就部署完成：

   ```sh
   nginx -s reload
   ```

3. **后端项目部署**

   查看当前本机端口运行情况：

   ```sh
   netstat -ntlp
   ```

   找出`Program name` = `java`的进程`PID`，然后停止运行：（如果没有该进程则本步骤不用操作）

   ```sh
   kill #PID
   ```

   打包后端项目使用Maven插件进行`package`打包，打包完成以后进入打包生成的`target`文件夹，将打包好的Jar包上传置服务器：

   ```sh
   scp Manage_system_bg-0.0.1-SNAPSHOT.jar root@218.194.100.49:Project/
   ```

   进入服务器运行项目：

   ```sh
   ssh root@218.194.100.49
   ```

   ```sh
   cd Project && nohup java -jar Manage_system_bg-0.0.1-SNAPSHOT.jar &
   ```

   

